{"version":3,"file":"auth.js","sources":["api/auth.js"],"sourcesContent":["/**\r\n * Authentication API\r\n */\r\n\r\nimport request from '@/utils/request'\r\n\r\n/**\r\n * User login\r\n * @param {string} openId - WeChat OpenID\r\n * @param {string} password - User password\r\n */\r\nexport function login(openId, password) {\r\n  return request({\r\n    url: '/v1/login',\r\n    method: 'POST',\r\n    data: { openId, password }\r\n  })\r\n}\r\n\r\n/**\r\n * User register\r\n * @param {Object} data - Registration data\r\n * @param {string} data.openId - WeChat OpenID\r\n * @param {string} data.username - Username\r\n * @param {string} data.password - Password\r\n */\r\nexport function register(data) {\r\n  return request({\r\n    url: '/v1/register',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\n/**\r\n * Get WeChat account info (exchange code for openId)\r\n * @param {string} code - WeChat login code\r\n * @param {string} iv - Encryption IV\r\n * @param {string} encryptedData - Encrypted user data\r\n */\r\nexport function getWeChatAccountInfo(code, iv, encryptedData) {\r\n  return request({\r\n    url: '/v1/wechat/account/info',\r\n    method: 'POST',\r\n    data: { code, iv, encryptedData }\r\n  })\r\n}\r\n\r\n/**\r\n * Silent login - exchange code for openId only\r\n * @param {string} code - WeChat login code\r\n */\r\nexport function code2Session(code) {\r\n  return request({\r\n    url: '/v1/wechat/account/code2session',\r\n    method: 'POST',\r\n    data: { code }\r\n  })\r\n}\r\n\r\n/**\r\n * WeChat silent login - get code only\r\n * Returns a Promise with the login code\r\n */\r\nexport function wxLogin() {\r\n  return new Promise((resolve, reject) => {\r\n    uni.login({\r\n      provider: 'weixin',\r\n      success: (res) => {\r\n        if (res.code) {\r\n          resolve(res.code)\r\n        } else {\r\n          reject(new Error('Failed to get login code'))\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * Check if user exists by openId\r\n * @param {string} openId - WeChat OpenID\r\n * @returns {Promise<{registered: boolean, username?: string, avatarUrl?: string}>}\r\n */\r\nexport function checkUserExists(openId) {\r\n  return request({\r\n    url: '/v1/user/exists',\r\n    method: 'GET',\r\n    data: { openId }\r\n  })\r\n}\r\n"],"names":["request"],"mappings":";;;AAWO,SAAS,MAAM,QAAQ,UAAU;AACtC,SAAOA,sBAAQ;AAAA,IACb,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,MAAM,EAAE,QAAQ,SAAU;AAAA,EAC9B,CAAG;AACH;AASO,SAAS,SAAS,MAAM;AAC7B,SAAOA,sBAAQ;AAAA,IACb,KAAK;AAAA,IACL,QAAQ;AAAA,IACR;AAAA,EACJ,CAAG;AACH;AAoBO,SAAS,aAAa,MAAM;AACjC,SAAOA,sBAAQ;AAAA,IACb,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,MAAM,EAAE,KAAM;AAAA,EAClB,CAAG;AACH;AA6BO,SAAS,gBAAgB,QAAQ;AACtC,SAAOA,sBAAQ;AAAA,IACb,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,MAAM,EAAE,OAAQ;AAAA,EACpB,CAAG;AACH;;;;;"}