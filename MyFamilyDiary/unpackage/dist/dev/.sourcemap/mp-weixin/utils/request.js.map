{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["/**\r\n * HTTP Request Utility\r\n */\r\n\r\nconst BASE_URL = 'https://service.jihao-family.com'\r\n\r\n// Generate trace ID\r\nfunction generateTraceId() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n    const r = Math.random() * 16 | 0\r\n    const v = c === 'x' ? r : (r & 0x3 | 0x8)\r\n    return v.toString(16)\r\n  })\r\n}\r\n\r\n/**\r\n * Request wrapper\r\n * @param {Object} options - Request options\r\n * @param {string} options.url - API endpoint (without base URL)\r\n * @param {string} options.method - HTTP method\r\n * @param {Object} options.data - Request body\r\n * @param {boolean} options.auth - Whether to include auth token\r\n */\r\nexport function request(options) {\r\n  return new Promise((resolve, reject) => {\r\n    const token = uni.getStorageSync('token')\r\n\r\n    const header = {\r\n      'Content-Type': 'application/json',\r\n      'x-trace-id': generateTraceId()\r\n    }\r\n\r\n    if (options.auth && token) {\r\n      header['Authorization'] = token.startsWith('Bearer ') ? token : `Bearer ${token}`\r\n    }\r\n\r\n    uni.request({\r\n      url: BASE_URL + options.url,\r\n      method: options.method || 'GET',\r\n      data: options.data,\r\n      header,\r\n      success: (res) => {\r\n        if (res.statusCode === 200 && res.data.success) {\r\n          resolve(res.data)\r\n        } else {\r\n          // 优先显示 errors 中的具体错误信息\r\n          let errorMsg = '请求失败'\r\n          if (res.data.errors) {\r\n            // errors 可能是字符串或数组\r\n            errorMsg = typeof res.data.errors === 'string'\r\n              ? res.data.errors\r\n              : res.data.errors[0] || res.data.message\r\n          } else if (res.data.message) {\r\n            errorMsg = res.data.message\r\n          }\r\n          uni.showToast({\r\n            title: errorMsg,\r\n            icon: 'none'\r\n          })\r\n          reject(res.data)\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        uni.showToast({\r\n          title: '网络错误，请检查网络连接',\r\n          icon: 'none'\r\n        })\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nexport default request\r\n"],"names":["uni"],"mappings":";;AAIA,MAAM,WAAW;AAGjB,SAAS,kBAAkB;AACzB,SAAO,uCAAuC,QAAQ,SAAS,SAAS,GAAG;AACzE,UAAM,IAAI,KAAK,OAAQ,IAAG,KAAK;AAC/B,UAAM,IAAI,MAAM,MAAM,IAAK,IAAI,IAAM;AACrC,WAAO,EAAE,SAAS,EAAE;AAAA,EACxB,CAAG;AACH;AAUO,SAAS,QAAQ,SAAS;AAC/B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExC,UAAM,SAAS;AAAA,MACb,gBAAgB;AAAA,MAChB,cAAc,gBAAiB;AAAA,IAChC;AAED,QAAI,QAAQ,QAAQ,OAAO;AACzB,aAAO,eAAe,IAAI,MAAM,WAAW,SAAS,IAAI,QAAQ,UAAU,KAAK;AAAA,IAChF;AAEDA,kBAAAA,MAAI,QAAQ;AAAA,MACV,KAAK,WAAW,QAAQ;AAAA,MACxB,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ;AAAA,MACd;AAAA,MACA,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,eAAe,OAAO,IAAI,KAAK,SAAS;AAC9C,kBAAQ,IAAI,IAAI;AAAA,QAC1B,OAAe;AAEL,cAAI,WAAW;AACf,cAAI,IAAI,KAAK,QAAQ;AAEnB,uBAAW,OAAO,IAAI,KAAK,WAAW,WAClC,IAAI,KAAK,SACT,IAAI,KAAK,OAAO,CAAC,KAAK,IAAI,KAAK;AAAA,UAC/C,WAAqB,IAAI,KAAK,SAAS;AAC3B,uBAAW,IAAI,KAAK;AAAA,UACrB;AACDA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AACD,iBAAO,IAAI,IAAI;AAAA,QAChB;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACbA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAChB,CAAS;AACD,eAAO,GAAG;AAAA,MACX;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;"}